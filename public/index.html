<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="ufo.ico" />

    <title>SpacePod - Make your parking space the pod of tomorrow.</title>
    <meta name="description" content="SpacePod" />
    <meta name="author" content="Autonomous Lions" />

    <!-- <link rel="stylesheet" href="css/styles.css?v=1.0" /> -->

    <script src="https://api.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.js"></script>
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.css"
      rel="stylesheet"
    />
  </head>

  <body>
    <!-- <script src="js/scripts.js"></script> -->
    <button onClick="dennsBiomarkt">Go to Denn's biomarkt</button>
    <div id="map" style="width: 1000px; height: 700px;"></div>
    <script>
      const busy = "#f02c2e";
      const booked = "#ffce5d";
      const free = "#5ac5b2";

      let it = 0;

      function addPointLayer(lat, lon, theId, theMap, status) {
        theMap.addLayer({
          id: theId,
          type: "circle",
          source: {
            type: "geojson",
            data: {
              type: "FeatureCollection",
              features: [
                {
                  type: "Feature",
                  geometry: {
                    type: "Point",
                    coordinates: [lon, lat]
                  },
                  properties: {
                    title: "Parkpoint",
                    icon: "monument"
                  }
                }
              ]
            }
          },
          paint: {
            "circle-radius": 5,
            "circle-color": busy
          }
        });
      }

      mapboxgl.accessToken =
        "pk.eyJ1IjoiamxlbmdyYW5kIiwiYSI6ImJrRUVlNk0ifQ.XmcYBGenB-uXVEvrCusv1Q";
      var map = new mapboxgl.Map({
        container: "map",
        // style: "mapbox://styles/mapbox/satellite-v9",
        style: "mapbox://styles/mapbox/streets-v11",
        center: [13.415755294789022, 52.54062410186097],
        zoom: 17
      });

      map.on("load", () => {
        const fakePoints = [
          [13.415439594708744, 52.54069601355556],
          [13.415519770235079, 52.54068288516504],
          [13.415593778420629, 52.54066413031887],
          [13.415646200871379, 52.54065850386641],
          [13.415726376409708, 52.54064537546466],
          [13.415729460074061, 52.540643499977364],
          [13.416080998931392, 52.540585359874456],
          [13.417425710862517, 52.540373205898135],
          [13.417539806817302, 52.54036195291053],
          [13.41767857214711, 52.54033382043258],
          [13.417829672182648, 52.54031318993583],
          [13.418270637595498, 52.54024379637761]
        ];

        fakePoints.map(point => {
          it++;
          // console.log(point[0], point[1]);
          addPointLayer(point[1], point[0], it.toString(), map, busy);
        });

        fetch("/poidump.json")
          .then(response => {
            if (response.status !== 200) {
              console.log(
                "Looks like there was a problem. Status Code: " +
                  response.status
              );
              return;
            }

            // Examine the text in the response
            response.json().then(data => {
              console.log(data);
              const poiCollection = data.poiCollection;

              poiCollection.map(poi => {
                // console.log(
                //   poi.gisCollection[0].latitude,
                //   poi.gisCollection[0].longitude
                // );
                addPointLayer(
                  poi.gisCollection[0].latitude,
                  poi.gisCollection[0].longitude,
                  poi.id.toString(),
                  map,
                  busy
                );
              });
            });
          })
          .catch(err => {
            console.log("Fetch Error :-S", err);
          });
      });

      // map.on("mousemove", e => {
      //   it++;
      //   console.log(it + " " + e.lngLat);
      // });
    </script>
  </body>
</html>
