<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="ufo.ico" />

    <title>SpacePod - Make your parking space the pod of tomorrow.</title>
    <meta name="description" content="SpacePod" />
    <meta name="author" content="Autonomous Lions" />

    <!-- <link rel="stylesheet" href="css/styles.css?v=1.0" /> -->

    <script src="https://api.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.js"></script>
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.css"
      rel="stylesheet"
    />
  </head>

  <body>
    <!-- <script src="js/scripts.js"></script> -->
    <div id="map" style="width: 1000px; height: 700px;"></div>
    <script>
      let it = 0;

      function addPointLayer(lat, lon, theId, theMap) {
        theMap.addLayer({
          id: theId,
          type: "circle",
          source: {
            type: "geojson",
            data: {
              type: "FeatureCollection",
              features: [
                {
                  type: "Feature",
                  geometry: {
                    type: "Point",
                    coordinates: [lon, lat]
                  },
                  properties: {
                    title: "Parkpoint",
                    icon: "monument"
                  }
                }
              ]
            }
          },
          paint: {
            "circle-radius": 10,
            "circle-color": "#007cbf"
          }
        });
      }

      mapboxgl.accessToken =
        "pk.eyJ1IjoiamxlbmdyYW5kIiwiYSI6ImJrRUVlNk0ifQ.XmcYBGenB-uXVEvrCusv1Q";
      var map = new mapboxgl.Map({
        container: "map",
        style: "mapbox://styles/mapbox/satellite-v9",
        center: [13.415755294789022, 52.54062410186097],
        zoom: 17
      });

      map.on("load", () => {
        fetch("/poidump.json")
          .then(response => {
            if (response.status !== 200) {
              console.log(
                "Looks like there was a problem. Status Code: " +
                  response.status
              );
              return;
            }

            // Examine the text in the response
            response.json().then(data => {
              console.log(data);
              const poiCollection = data.poiCollection;

              poiCollection.map(poi => {
                console.log(
                  poi.gisCollection[0].latitude,
                  poi.gisCollection[0].longitude
                );
                addPointLayer(
                  poi.gisCollection[0].latitude,
                  poi.gisCollection[0].longitude,
                  poi.id.toString(),
                  map
                );
              });
            });
          })
          .catch(err => {
            console.log("Fetch Error :-S", err);
          });
      });

      map.on("mousemove", e => {
        it++;
        console.log(it + " " + e.lngLat);
      });
    </script>
  </body>
</html>
